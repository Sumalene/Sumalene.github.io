<!-- start custom footer snippets -->
<script>
// 自执行函数避免污染全局作用域
(function() {
    // 配置
    const CONFIG = {
        live2d_path: "https://fastly.jsdelivr.net/gh/lrplrplrp/live2d@master/",
        model_path: "https://ghproxy.net/https://raw.githubusercontent.com/lrplrplrp/live2d_api/refs/heads/master/",
        minWidth: 768 // 最小加载宽度
    };
    
    // 加载资源
    function loadResource(url, type) {
        return new Promise((resolve, reject) => {
            const el = type === 'css' 
                ? Object.assign(document.createElement('link'), { rel: 'stylesheet', href: url })
                : Object.assign(document.createElement('script'), { src: url });
            
            el.onload = () => resolve(url);
            el.onerror = () => reject(url);
            document.head.appendChild(el);
        });
    }
    
    // 主加载函数
    async function initLive2D() {
        if (screen.width < CONFIG.minWidth) return;
        
        try {
            await Promise.all([
                loadResource(CONFIG.live2d_path + 'pixi.min.js', 'js'),
                loadResource(CONFIG.live2d_path + 'live2d.min.js', 'js'),
                loadResource(CONFIG.live2d_path + 'live2dcubismcore.min.js', 'js'),
                loadResource('https://libs.baidu.com/jquery/2.0.0/jquery.min.js', 'js'),
                loadResource(CONFIG.live2d_path + 'waifu.css', 'css'),
                loadResource('https://cdn.bootcdn.net/ajax/libs/font-awesome/6.0.0/css/all.min.css', 'css')
            ]);
            
            await loadResource(CONFIG.live2d_path + 'index.min.js', 'js');
            await loadResource(CONFIG.live2d_path + 'waifu-tips.js', 'js');
            
            // 等待初始化函数可用
            await new Promise(resolve => {
                const checkInit = () => typeof initWidget === 'function' ? resolve() : setTimeout(checkInit, 100);
                checkInit();
            });
            
            initWidget({
                waifuPath: CONFIG.model_path + 'waifu-tips.json',
                modelListPath: CONFIG.model_path + 'model_list.json',
                modelPath: CONFIG.model_path
            });
        } catch (e) {
            console.warn('Live2D加载失败，但不影响页面使用:', e);
        }
    }
    
    // 延迟加载，确保不阻塞主线程
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initLive2D);
    } else {
        setTimeout(initLive2D, 300);
    }
})();
</script>
<!-- end custom footer snippets -->
